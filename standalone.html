<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIæ–‡ç« æ¶¦è‰²å™¨ - ç‹¬ç«‹ç‰ˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 8px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .api-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .api-section h3 {
      margin-bottom: 12px;
      color: #333;
    }

    .api-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      font-family: monospace;
    }

    .api-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .main-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      resize: vertical;
      margin-bottom: 16px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    select {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button {
      padding: 12px 32px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .button-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .button-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .button-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .button-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .button-secondary:hover {
      background: #e0e0e0;
    }

    .output-box {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      min-height: 150px;
      white-space: pre-wrap;
      word-wrap: break-word;
      color: #333;
      font-size: 15px;
      line-height: 1.6;
      margin-top: 16px;
    }

    .output-box.placeholder {
      color: #999;
      font-style: italic;
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .alert {
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .alert-error {
      background: #fee;
      color: #c00;
      border: 1px solid #fcc;
    }

    .alert-success {
      background: #efe;
      color: #080;
      border: 1px solid #cfc;
    }

    .token-info {
      font-size: 12px;
      color: #999;
      margin-top: 8px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <h1>âœ¨ AIæ–‡ç« æ¶¦è‰²å™¨ï¼ˆç‹¬ç«‹ç‰ˆï¼‰</h1>
      <p>ç›´æ¥è°ƒç”¨æ™ºè°± AI APIï¼Œæ— éœ€åç«¯æœåŠ¡å™¨</p>
    </div>

    <!-- API é…ç½® -->
    <div class="api-section">
      <h3>ğŸ”‘ æ™ºè°± API Key</h3>
      <input type="text" id="apiKey" class="api-input" placeholder="è¯·è¾“å…¥ä½ çš„æ™ºè°± API Keyï¼ˆæ ¼å¼ï¼šxxx.yyyyyyyyyï¼‰">
      <div style="margin-top: 8px; font-size: 12px; color: #999;">
        API Key åªä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨
      </div>
    </div>

    <!-- é”™è¯¯æç¤º -->
    <div class="alert alert-error hidden" id="errorAlert"></div>
    <div class="alert alert-success hidden" id="successAlert"></div>

    <!-- ä¸»å¡ç‰‡ -->
    <div class="main-card">
      <textarea id="inputText" placeholder="è¯·è¾“å…¥éœ€è¦æ¶¦è‰²çš„æ–‡ç« å†…å®¹..."></textarea>

      <div class="controls">
        <select id="styleSelect">
          <option value="professional">ä¸“ä¸šæ­£å¼</option>
          <option value="casual">è½»æ¾è‡ªç„¶</option>
          <option value="concise">ç®€æ´æ˜äº†</option>
          <option value="creative">åˆ›æ„ç”ŸåŠ¨</option>
        </select>
        <button class="button button-primary" id="polishBtn" onclick="polish()">
          âœ¨ å¼€å§‹æ¶¦è‰²
        </button>
        <button class="button button-secondary" onclick="clearAll()">
          ğŸ—‘ï¸ æ¸…ç©º
        </button>
      </div>

      <div class="token-info" id="tokenInfo"></div>

      <div class="output-box placeholder" id="outputBox">æ¶¦è‰²åçš„æ–‡ç« å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>

      <button class="button button-secondary hidden" id="copyBtn" onclick="copyResult()" style="margin-top: 16px;">
        ğŸ“‹ å¤åˆ¶ç»“æœ
      </button>
    </div>
  </div>

  <script>
    // ä» localStorage åŠ è½½ API Key
    window.onload = function() {
      const savedKey = localStorage.getItem('zhipu_api_key');
      if (savedKey) {
        document.getElementById('apiKey').value = savedKey;
      }
    };

    // ä¿å­˜ API Key åˆ° localStorage
    document.getElementById('apiKey').addEventListener('change', function() {
      localStorage.setItem('zhipu_api_key', this.value);
    });

    // æ¶¦è‰²æ–‡ç« 
    async function polish() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const text = document.getElementById('inputText').value.trim();
      const style = document.getElementById('styleSelect').value;
      const btn = document.getElementById('polishBtn');

      if (!apiKey) {
        showError('è¯·å…ˆè¾“å…¥æ™ºè°± API Key');
        return;
      }

      if (!text) {
        showError('è¯·è¾“å…¥éœ€è¦æ¶¦è‰²çš„æ–‡ç« å†…å®¹');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>æ¶¦è‰²ä¸­...';

      hideAlerts();
      document.getElementById('outputBox').textContent = 'æ­£åœ¨æ¶¦è‰²ï¼Œè¯·ç¨å€™...';
      document.getElementById('outputBox').classList.remove('placeholder');

      try {
        const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: 'glm-4-flash',
            messages: [
              {
                role: 'system',
                content: `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–‡ç« æ¶¦è‰²ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„é£æ ¼å¯¹æ–‡ç« è¿›è¡Œæ¶¦è‰²ã€‚

å¯é€‰é£æ ¼ï¼š
- professional: ä¸“ä¸šæ­£å¼ï¼Œé€‚åˆå•†åŠ¡æ–‡æ¡£ã€å­¦æœ¯è®ºæ–‡
- casual: è½»æ¾è‡ªç„¶ï¼Œé€‚åˆåšå®¢ã€ç¤¾äº¤åª’ä½“
- concise: ç®€æ´æ˜äº†ï¼Œçªå‡ºé‡ç‚¹
- creative: åˆ›æ„ç”ŸåŠ¨ï¼Œå¸å¼•çœ¼çƒ

è¯·åªè¿”å›æ¶¦è‰²åçš„æ–‡ç« ï¼Œä¸è¦è§£é‡Šã€‚`
              },
              {
                role: 'user',
                content: `è¯·å°†ä»¥ä¸‹æ–‡ç« æ¶¦è‰²ä¸º${style}é£æ ¼ï¼š\n\n${text}`
              }
            ],
            temperature: 0.7,
            max_tokens: 2000
          })
        });

        const data = await response.json();

        if (response.ok && data.choices && data.choices[0]) {
          const polishedText = data.choices[0].message.content;
          const tokensUsed = data.usage?.total_tokens || 0;

          document.getElementById('outputBox').textContent = polishedText;
          document.getElementById('outputBox').classList.remove('placeholder');
          document.getElementById('copyBtn').classList.remove('hidden');
          document.getElementById('tokenInfo').textContent = `æœ¬æ¬¡æ¶ˆè€—: ${tokensUsed} tokens`;

          showSuccess('âœ¨ æ¶¦è‰²å®Œæˆï¼');
        } else {
          const errorMsg = data.error?.message || data.error || 'æ¶¦è‰²å¤±è´¥';
          showError('API é”™è¯¯: ' + errorMsg);
          document.getElementById('outputBox').textContent = 'æ¶¦è‰²å¤±è´¥ï¼Œè¯·é‡è¯•';
          document.getElementById('outputBox').classList.add('placeholder');
        }
      } catch (error) {
        showError('ç½‘ç»œé”™è¯¯: ' + error.message);
        document.getElementById('outputBox').textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•';
        document.getElementById('outputBox').classList.add('placeholder');
      }

      btn.disabled = false;
      btn.innerHTML = 'âœ¨ å¼€å§‹æ¶¦è‰²';
    }

    // æ¸…ç©ºæ‰€æœ‰
    function clearAll() {
      document.getElementById('inputText').value = '';
      document.getElementById('outputBox').textContent = 'æ¶¦è‰²åçš„æ–‡ç« å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
      document.getElementById('outputBox').classList.add('placeholder');
      document.getElementById('copyBtn').classList.add('hidden');
      document.getElementById('tokenInfo').textContent = '';
      hideAlerts();
    }

    // å¤åˆ¶ç»“æœ
    function copyResult() {
      const text = document.getElementById('outputBox').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'âœ… å·²å¤åˆ¶';
        setTimeout(() => {
          btn.textContent = 'ğŸ“‹ å¤åˆ¶ç»“æœ';
        }, 2000);
      });
    }

    // æ˜¾ç¤ºé”™è¯¯
    function showError(message) {
      const alert = document.getElementById('errorAlert');
      alert.textContent = message;
      alert.classList.remove('hidden');
      document.getElementById('successAlert').classList.add('hidden');
    }

    // æ˜¾ç¤ºæˆåŠŸ
    function showSuccess(message) {
      const alert = document.getElementById('successAlert');
      alert.textContent = message;
      alert.classList.remove('hidden');
      document.getElementById('errorAlert').classList.add('hidden');
    }

    // éšè—æ‰€æœ‰æç¤º
    function hideAlerts() {
      document.getElementById('errorAlert').classList.add('hidden');
      document.getElementById('successAlert').classList.add('hidden');
    }
  </script>
</body>
</html>
